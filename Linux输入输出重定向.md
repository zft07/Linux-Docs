# Linux 输入输出重定向



在很多定时任务里、shell脚本里，我们往往能看到 "2>&1"，举个例子：

```bash
* 1 * * * test.sh > /dev/null 2>&1
```
这里的”2>&1“的意思是把标准错误重定向到标准输出。


上面的例子"2>&1"是将标准错误重定向到标准输出，而test.sh的标准输出就是/dev/null，所以这条语句的结果（标准输出、标准错误）都会打到/dev/null。
用c来表示可以更加清楚细节：

```bash
int fd = open("/dev/null", "w+");
dup2(fd, 1); # 将标准输出重定向至/dev/null
dup2(1, 2); # 将标准错误重定向至标准输出
```


我们调换一下/dev/null和2>&1的位置：

```bash
* 1 * * * test.sh 2>&1 > /dev/null
```

这里表示先将标准错误重定向至标准输出，再将标准输出重定向至/dev/null。这样的结果就是还能看见标准错误。





## 标准输入(stdin), 标准输出(stdout), 标准错误(stderr)


默认情况下，Unix/Linux系统中总是有三个文件处于打开状态：标准输入(键盘输入)、标准输出(输出到屏幕)、标准错误(也是输出到屏幕)，它们分别对应的文件描述符是0，1，2。




## /dev/null文件


/dev/null是一个特殊的文件，代表linux的空设备文件，写入到它的内容都会被丢弃，俗称“黑洞”。如果尝试从该文件读取内容，那么什么也读取不到。

/dev/null文件非常的有用，将命令的输出重定向到它，会起到“静止输出”的效果。



## Linux IO重定向


命令的输入可以来自于键盘或者文件，输出可以打印在终端模拟器，也可以打印到文件，这里就需要用到I/O的重定向特性，利用I/O 的重定向功能还可以实现强大的命令管道。




### 标准输出重定向


标准输出一般是输出到屏幕的，但是我们使用 I/O 的重定向功能可以将标准输出重定向到其他地方，比如一个文件。重定向需要使用 ">" 重定向符号实现。下面是一个例子：

```bash
ls -l /usr/bin > ls-output.txt
```

我们把 ls -l /usr/bin 的结果作为输入，使用 > 将其重定向到 ls-output.txt 这个文件。




### 标准错误重定向


为了重定向标准错误，我们可用这样写：

```bash
ls -l /bin/usr 2> ls-error.txt
```

注意： 文件描述符 2，要紧挨着放在重定向操作符之前，中间没有空格。还是看看终端有没有回显，ls-error.txt 的内容吧。





### 标准输出、标准错误同时重定向


我们希望捕捉一个命令的所有输出到一个文件。为了完成这个，我们必须同时重定向标准输出和标准错误。有两种方法来完成任务。

1)传统的方法

在旧版本shell中也有效：

```bash
ls -l /bin/usr > ls-output.txt 2>&1
```

使用这种方法，我们完成两个重定向。首先重定向标准输出到文件 ls-output.txt，然后 重定向文件描述符 2（标准错误）到文件描述符 1（标准输出）使用表示法 2>&1。

2) 现在的 bash 版本提供了第二种方法，更精简合理的方法来执行这种联合的重定向：

```bash
ls -l /bin/usr &> ls-output.txt
```



### 标准输入重定向

cat命令读取一个或多个文件，然后复制它们到标准输出。

```bash
cat < ls-output.txt
```

我们是使用 < 输入重定向，把输入从键盘等输入设备改成从一个文件的内容作为输入。

如果还没有理解，你可以在终端只输入 cat 命令，这时候没有任何响应，其实 cat 是在等待输入，我们键盘上随便输入一些内容，然后按 ctrl + d 告诉 cat 输入已经达到末尾，看看效果吧。



### 操作符号

```bash
1) >:	输出重定向，文件不存在创建，存在截断


#将ls的内容输出到文本ls.txt中
ls >ls.txt



2) >>：	输出重定向，文件不存在创建，存在追加内容


ls >>ls.txt
#输出重定向其实在操作符（>，>>）的左边是有文件描述符的，右边是输出内容的文件。



3) &>：	如果需要将 stdout，stderr 都重定向到同一文件上的话可以使用 & 表示描述符 1,2。


#注意 &> 只在 Bash 4 以上提供。
cmd_succ_or_err &>log.txt

4) >&:	提供了一种文件描述符到文件描述符的操作，左边描述符若未指定默认为 1。



cmd 2>&1                 # 将错误输出（stderr）重定向到标准输出（stdout）。
cmd >&2                  # 将标准输出重定向到错误输出。
```